#!/bin/bash
curl 'https://kakogawa.diycities.jp/api/' -H 'Accept-Encoding: gzip, deflate, br' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'Connection: keep-alive' -H 'DNT: 1' -H 'Origin: file://' --data-binary '{"query":"# Write your query or mutation here\nquery {\n  participatoryProcesses {\n    id\n    title {\n      translations {\n        locale\n        text\n      }\n    }\n    components {\n      id\n      name {\n        translation(locale: \"ja\")\n      }\n      ... on Debates {\n        debates {\n          edges {\n            node {\n              title {\n                translation(locale: \"ja\")\n              }\n              totalCommentsCount\n              comments {\n                id\n                author {\n                  id\n                  name\n                }\n                body\n                comments{\n                  id\n                  author {\n                    id\n                    name\n                  }\n                  body\n                  comments{\n                    id\n                    author{\n                      id\n                      name\n                    }\n                    body\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  decidim {\n    version\n  }\n}\n"}' --compressed | jq -r 'recurse | select(.author?) | [.author.id, .author.name] | @csv '| sort | uniq -c | sort -r
